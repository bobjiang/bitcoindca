"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[993],{3669:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>l,contentTitle:()=>c,default:()=>h,frontMatter:()=>d,metadata:()=>t,toc:()=>o});const t=JSON.parse('{"id":"reference/api-reference","title":"API Reference","description":"Public contract APIs and key parameters for integrating with DCA Crypto. All signatures originate from ABI tests in the repository.","source":"@site/docs/reference/api-reference.md","sourceDirName":"reference","slug":"/reference/api-reference","permalink":"/docs/reference/api-reference","draft":false,"unlisted":false,"editUrl":"https://github.com/bobjiang/dcacrypto/tree/main/docs/docs/reference/api-reference.md","tags":[],"version":"current","frontMatter":{"title":"API Reference","sidebar_label":"API Reference","description":"Public contract APIs and key parameters for integrating with DCA Crypto. All signatures originate from ABI tests in the repository."},"sidebar":"primarySidebar","previous":{"title":"Testing","permalink":"/docs/developer/testing"},"next":{"title":"Events","permalink":"/docs/reference/events"}}');var r=i(7711),s=i(6879);const d={title:"API Reference",sidebar_label:"API Reference",description:"Public contract APIs and key parameters for integrating with DCA Crypto. All signatures originate from ABI tests in the repository."},c="API Reference",l={},o=[{value:"DcaManager",id:"dcamanager",level:2},{value:"Position lifecycle",id:"position-lifecycle",level:3},{value:"Funds management",id:"funds-management",level:3},{value:"Views",id:"views",level:3},{value:"Configuration",id:"configuration",level:3},{value:"Executor",id:"executor",level:2},{value:"Events",id:"events",level:3},{value:"PriceOracle",id:"priceoracle",level:2},{value:"Treasury",id:"treasury",level:2},{value:"Router adapters",id:"router-adapters",level:2},{value:"PositionNFT",id:"positionnft",level:2},{value:"Error catalogue",id:"error-catalogue",level:2}];function a(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"api-reference",children:"API Reference"})}),"\n",(0,r.jsxs)(n.p,{children:["This reference covers the primary smart contracts. Always verify against the generated ABIs in ",(0,r.jsx)(n.code,{children:"contracts/artifacts/"})," after building."]}),"\n",(0,r.jsx)(n.h2,{id:"dcamanager",children:"DcaManager"}),"\n",(0,r.jsx)(n.h3,{id:"position-lifecycle",children:"Position lifecycle"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Signature"}),(0,r.jsx)(n.th,{children:"Description"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"function createPosition(CreatePositionParams calldata params) external returns (uint256 positionId)"})}),(0,r.jsxs)(n.td,{children:["Creates a new position, mints a ",(0,r.jsx)(n.code,{children:"PositionNFT"}),", sets ",(0,r.jsx)(n.code,{children:"nextExecAt"}),"."]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"function modify(uint256 positionId, ModifyParams calldata params) external"})}),(0,r.jsx)(n.td,{children:"Updates mutable guardrails and metadata."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"function pause(uint256 positionId) external"})}),(0,r.jsx)(n.td,{children:"Marks position as paused."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"function resume(uint256 positionId) external"})}),(0,r.jsx)(n.td,{children:"Clears pause flag and schedules next execution."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"function cancel(uint256 positionId) external"})}),(0,r.jsx)(n.td,{children:"Closes and refunds a position, burns the NFT."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"function emergencyWithdraw(uint256 positionId) external"})}),(0,r.jsx)(n.td,{children:"Initiates emergency withdrawal flow."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"function completeEmergencyWithdraw(uint256 positionId) external"})}),(0,r.jsx)(n.td,{children:"Final step after timelock delay."})]})]})]}),"\n",(0,r.jsx)(n.h3,{id:"funds-management",children:"Funds management"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Signature"}),(0,r.jsx)(n.th,{children:"Description"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"function deposit(uint256 positionId, address token, uint256 amount) external"})}),(0,r.jsx)(n.td,{children:"Adds idle quote/base balance."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"function withdraw(uint256 positionId, address token, uint256 amount, address to) external"})}),(0,r.jsx)(n.td,{children:"Transfers funds to beneficiary or custom address."})]})]})]}),"\n",(0,r.jsx)(n.h3,{id:"views",children:"Views"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Signature"}),(0,r.jsx)(n.th,{children:"Description"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"function getPosition(uint256 positionId) external view returns (Position memory)"})}),(0,r.jsx)(n.td,{children:"Full position struct."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"function getPositionBalance(uint256 positionId) external view returns (uint256 quoteBal, uint256 baseBal)"})}),(0,r.jsx)(n.td,{children:"Idle balances."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"function getNextExecutionTime(uint256 positionId) external view returns (uint64)"})}),(0,r.jsx)(n.td,{children:"Scheduled timestamp."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"function isPositionEligible(uint256 positionId) external view returns (bool)"})}),(0,r.jsx)(n.td,{children:"Keeper-friendly eligibility check."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"function positionsByOwner(address owner) external view returns (uint256[] memory)"})}),(0,r.jsx)(n.td,{children:"Owned position IDs."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"function globalPauseState() external view returns (bool systemPaused, uint64 resumeAt)"})}),(0,r.jsx)(n.td,{children:"High-level pause signal."})]})]})]}),"\n",(0,r.jsx)(n.h3,{id:"configuration",children:"Configuration"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Signature"}),(0,r.jsx)(n.th,{children:"Notes"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"function setProtocolConfig(ProtocolConfig calldata config) external onlyRole(TREASURER_ROLE)"})}),(0,r.jsx)(n.td,{children:"Updates fees and collectors."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"function setCircuitBreakerConfig(CircuitBreakerConfig calldata config) external onlyRole(PAUSER_ROLE)"})}),(0,r.jsx)(n.td,{children:"Updates global limits."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"function setVenueConfig(uint16 venue, address adapter, VenueConfig calldata config) external onlyRole(ROUTER_ADMIN_ROLE)"})}),(0,r.jsx)(n.td,{children:"Whitelists/updates adapters."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"function setKeeperRegistry(address chainlinkRegistry, address gelatoRegistry) external onlyRole(KEEPER_ROLE)"})}),(0,r.jsx)(n.td,{children:"Points automation to current registries."})]})]})]}),"\n",(0,r.jsx)(n.h2,{id:"executor",children:"Executor"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Signature"}),(0,r.jsx)(n.th,{children:"Description"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"function execute(uint256 positionId) external nonReentrant"})}),(0,r.jsx)(n.td,{children:"Executes a single position."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"function batchExecute(uint256[] calldata positionIds) external nonReentrant"})}),(0,r.jsx)(n.td,{children:"Batch execution."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"function simulate(uint256 positionId) external view returns (ExecutionResult memory)"})}),(0,r.jsx)(n.td,{children:"Deterministic simulation for keepers."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"function setKeeper(address keeper, bool allowed) external onlyRole(EXECUTOR_ROLE)"})}),(0,r.jsx)(n.td,{children:"Manage authorised keeper addresses."})]})]})]}),"\n",(0,r.jsx)(n.h3,{id:"events",children:"Events"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"event ExecutionCompleted(uint256 indexed positionId, address indexed keeper);"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"event ExecutionSkipped(uint256 indexed positionId, string reason);"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"event ExecutionDetails(uint256 indexed positionId, address indexed keeper, uint256 gasUsed, bytes routePath, int256 priceImpactBps, uint256 twapWindow, uint256 oracleTimestamp);"})}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"priceoracle",children:"PriceOracle"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Signature"}),(0,r.jsx)(n.th,{children:"Description"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"function getQuoteUsd(address asset) external view returns (uint256 price, uint256 updatedAt)"})}),(0,r.jsx)(n.td,{children:"USD price from Chainlink feeds."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"function getTwap(address pool, uint32 window) external view returns (uint256 priceX96)"})}),(0,r.jsx)(n.td,{children:"Uniswap v3 TWAP calculation."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"function validatePrice(address base, address quote, uint32 window, uint16 deviationBps) external view returns (bool ok, uint256 referencePriceUsd, uint256 deviation)"})}),(0,r.jsx)(n.td,{children:"Combined guard logic used by executor."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"function setFeed(address asset, address feed) external onlyRole(ORACLE_ADMIN_ROLE)"})}),(0,r.jsx)(n.td,{children:"Update Chainlink aggregators."})]})]})]}),"\n",(0,r.jsx)(n.h2,{id:"treasury",children:"Treasury"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Signature"}),(0,r.jsx)(n.th,{children:"Description"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"function withdraw(address token, uint256 amount, address to) external onlyRole(TREASURER_ROLE)"})}),(0,r.jsx)(n.td,{children:"Disburse fees."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"function schedule(address target, uint256 value, bytes calldata data, bytes32 salt, uint256 delay) external onlyRole(TREASURER_ROLE)"})}),(0,r.jsx)(n.td,{children:"Timelock scheduling."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"function execute(address target, uint256 value, bytes calldata data, bytes32 salt) external onlyRole(TREASURER_ROLE)"})}),(0,r.jsx)(n.td,{children:"Finalise scheduled action."})]})]})]}),"\n",(0,r.jsx)(n.h2,{id:"router-adapters",children:"Router adapters"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Adapter"}),(0,r.jsx)(n.th,{children:"Signature"}),(0,r.jsx)(n.th,{children:"Purpose"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"UniV3Adapter"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"swapExactInput(SwapParams calldata params)"})}),(0,r.jsx)(n.td,{children:"Executes exact-input swaps via Uniswap v3 pools."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"CowAdapter"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"placeOrder(CowOrder calldata order)"})}),(0,r.jsx)(n.td,{children:"Submits CoW Protocol orders and validates settlement."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"OneInchAdapter"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"executeAggregatorSwap(bytes calldata data)"})}),(0,r.jsx)(n.td,{children:"Executes prebuilt 1inch quotes."})]})]})]}),"\n",(0,r.jsxs)(n.p,{children:["Adapters expose minimal state and revert with descriptive errors captured in ",(0,r.jsx)(n.code,{children:"routerAdapters.abi.spec.ts"}),"."]}),"\n",(0,r.jsx)(n.h2,{id:"positionnft",children:"PositionNFT"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Signature"}),(0,r.jsx)(n.th,{children:"Description"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"function mint(address to, uint256 positionId) external"})}),(0,r.jsx)(n.td,{children:"Called by manager on create."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"function burn(uint256 tokenId) external"})}),(0,r.jsx)(n.td,{children:"Called by manager on cancel."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsxs)(n.td,{children:["Standard ERC-721 functions (",(0,r.jsx)(n.code,{children:"ownerOf"}),", ",(0,r.jsx)(n.code,{children:"transferFrom"}),", ",(0,r.jsx)(n.code,{children:"safeTransferFrom"}),") remain available."]}),(0,r.jsx)(n.td,{})]})]})]}),"\n",(0,r.jsx)(n.h2,{id:"error-catalogue",children:"Error catalogue"}),"\n",(0,r.jsx)(n.p,{children:"Common custom errors surfaced in tests and guard logic:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"error PriceDeviationExceeded(uint256 deviationBps);"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"error TwapWindowTooShort(uint32 provided, uint32 minimum);"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"error PositionPaused(uint256 positionId);"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"error InsufficientBalance(uint256 available, uint256 requested);"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"error GasCapExceeded(uint64 baseFee, uint64 maxBaseFee);"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"error DepegDetected(address quote, uint256 priceUsd);"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"error ImmutableField();"})}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Use these constants in monitoring/alerting systems to provide actionable failure messages."})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(a,{...e})}):a(e)}},6879:(e,n,i)=>{i.d(n,{R:()=>d,x:()=>c});var t=i(3303);const r={},s=t.createContext(r);function d(e){const n=t.useContext(s);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:d(e.components),t.createElement(s.Provider,{value:n},e.children)}}}]);