"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[217],{847:(e,s,i)=>{i.r(s),i.d(s,{assets:()=>d,contentTitle:()=>o,default:()=>h,frontMatter:()=>c,metadata:()=>r,toc:()=>l});const r=JSON.parse('{"id":"core-concepts/security-controls","title":"Security Controls","description":"Review the guardrails, circuit breakers, and operational procedures that protect BitcoinDCA users and liquidity.","source":"@site/docs/core-concepts/security-controls.md","sourceDirName":"core-concepts","slug":"/core-concepts/security-controls","permalink":"/docs/core-concepts/security-controls","draft":false,"unlisted":false,"editUrl":"https://github.com/bobjiang/bitcoindca/tree/main/docs/docs/core-concepts/security-controls.md","tags":[],"version":"current","frontMatter":{"title":"Security Controls","sidebar_label":"Security Controls","description":"Review the guardrails, circuit breakers, and operational procedures that protect BitcoinDCA users and liquidity."},"sidebar":"primarySidebar","previous":{"title":"Execution Pipeline","permalink":"/docs/core-concepts/execution-pipeline"},"next":{"title":"Create a Position","permalink":"/docs/user-guides/create-position"}}');var n=i(7711),t=i(6879);const c={title:"Security Controls",sidebar_label:"Security Controls",description:"Review the guardrails, circuit breakers, and operational procedures that protect BitcoinDCA users and liquidity."},o="Security Controls",d={},l=[{value:"Guard categories",id:"guard-categories",level:2},{value:"Price integrity",id:"price-integrity",level:3},{value:"Execution environment",id:"execution-environment",level:3},{value:"System-level circuit breakers",id:"system-level-circuit-breakers",level:3},{value:"Tests covering invariants",id:"tests-covering-invariants",level:2},{value:"Access control &amp; roles",id:"access-control--roles",level:2},{value:"Upgrade safety",id:"upgrade-safety",level:2},{value:"Incident response",id:"incident-response",level:2}];function a(e){const s={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(s.header,{children:(0,n.jsx)(s.h1,{id:"security-controls",children:"Security Controls"})}),"\n",(0,n.jsxs)(s.p,{children:["Security in BitcoinDCA is anchored around deterministic guardrails, rigorous testing, and multi-venue MEV mitigation. This page aligns with the invariants defined in ",(0,n.jsx)(s.code,{children:"AGENTS.md"})," \xa75."]}),"\n",(0,n.jsx)(s.h2,{id:"guard-categories",children:"Guard categories"}),"\n",(0,n.jsx)(s.h3,{id:"price-integrity",children:"Price integrity"}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsxs)(s.li,{children:[(0,n.jsxs)(s.strong,{children:["TWAP window (",(0,n.jsx)(s.code,{children:"twapWindow"}),")"]})," \u2014 Minimum 3600 seconds. Ensures execution price tracks long-term market trends, protecting against short-lived spikes."]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsxs)(s.strong,{children:["Max price deviation (",(0,n.jsx)(s.code,{children:"maxPriceDeviationBps"}),")"]})," \u2014 Default 100 (1%). Compares execution quote to both Chainlink and Uniswap v3 TWAP references."]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:"Depeg guard"})," \u2014 Checks quote stablecoin (USDC) price \u2248 $1 before allowing BUY orders."]}),"\n"]}),"\n",(0,n.jsx)(s.h3,{id:"execution-environment",children:"Execution environment"}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsxs)(s.li,{children:[(0,n.jsxs)(s.strong,{children:["Slippage (",(0,n.jsx)(s.code,{children:"slippageBps"}),")"]})," \u2014 Per-position tolerance, capped by a manager-wide maximum."]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsxs)(s.strong,{children:["Gas caps (",(0,n.jsx)(s.code,{children:"maxBaseFeeWei"}),", ",(0,n.jsx)(s.code,{children:"maxPriorityFeeWei"}),")"]})," \u2014 Prevents executions when gas spikes occur."]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:"MEV posture"})," \u2014 Private execution modes prefer Flashbots/CoW. Public fallback halves slippage tolerance."]}),"\n"]}),"\n",(0,n.jsx)(s.h3,{id:"system-level-circuit-breakers",children:"System-level circuit breakers"}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:"Global limits"})," \u2014 ",(0,n.jsx)(s.code,{children:"maxGlobalPositions"}),", ",(0,n.jsx)(s.code,{children:"maxPositionsPerUser"}),", and ",(0,n.jsx)(s.code,{children:"minPositionSizeUsd"}),"."]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:"Pause levers"})," \u2014 Role-gated ",(0,n.jsx)(s.code,{children:"pause"}),"/",(0,n.jsx)(s.code,{children:"unpause"})," for asset-specific incidents."]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:"Emergency withdrawal"})," \u2014 Time-delayed exit for users if routing stacks are degraded."]}),"\n"]}),"\n",(0,n.jsx)(s.h2,{id:"tests-covering-invariants",children:"Tests covering invariants"}),"\n",(0,n.jsxs)(s.table,{children:[(0,n.jsx)(s.thead,{children:(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.th,{children:"Test file"}),(0,n.jsx)(s.th,{children:"Focus area"}),(0,n.jsx)(s.th,{children:"Key expectations"})]})}),(0,n.jsxs)(s.tbody,{children:[(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"contracts/test/security/Reentrancy.test.ts"})}),(0,n.jsx)(s.td,{children:"External entrypoints"}),(0,n.jsxs)(s.td,{children:["Ensures ",(0,n.jsx)(s.code,{children:"nonReentrant"})," guards and state snapshots prevent double spend"]})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"contracts/test/security/MEVProtection.test.ts"})}),(0,n.jsx)(s.td,{children:"Routing posture"}),(0,n.jsx)(s.td,{children:"Validates private mode, price deviation checks, and skip reasons"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"contracts/test/security/DOSProtection.test.ts"})}),(0,n.jsx)(s.td,{children:"Circuit breakers"}),(0,n.jsx)(s.td,{children:"Blocks execution when global pause or cap is active"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"contracts/test/system.behavior.spec.ts"})}),(0,n.jsx)(s.td,{children:"End-to-end flow"}),(0,n.jsx)(s.td,{children:"Confirms execution schedule, gas caps, and guards interact correctly"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"contracts/test/oracle.abi.spec.ts"})}),(0,n.jsx)(s.td,{children:"Oracle interface"}),(0,n.jsx)(s.td,{children:"Verifies Chainlink feed exposure to keepers and UI"})]})]})]}),"\n",(0,n.jsxs)(s.p,{children:["All tests can be run with ",(0,n.jsx)(s.code,{children:"pnpm -F contracts test"}),". CI pipelines block merges that violate these invariants."]}),"\n",(0,n.jsx)(s.h2,{id:"access-control--roles",children:"Access control & roles"}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.code,{children:"DEFAULT_ADMIN_ROLE"})," \u2014 Multisig / timelock with authority over upgrades and configuration."]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.code,{children:"PAUSER_ROLE"})," \u2014 Can pause/unpause manager and executor."]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.code,{children:"EXECUTOR_ROLE"})," / ",(0,n.jsx)(s.code,{children:"KEEPER_ROLE"})," \u2014 Grants execution permissions to Chainlink/Gelato registries."]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.code,{children:"TREASURER_ROLE"})," \u2014 Manages treasury withdrawals and protocol fee configuration."]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.code,{children:"EMERGENCY_ROLE"})," \u2014 Triggers emergency withdrawal timers and global stop-gaps."]}),"\n"]}),"\n",(0,n.jsxs)(s.p,{children:["Roles inherit from OpenZeppelin ",(0,n.jsx)(s.code,{children:"AccessControl"})," with explicit revocation flows. See ",(0,n.jsx)(s.code,{children:"contracts/test/treasury.abi.spec.ts"})," for coverage."]}),"\n",(0,n.jsx)(s.h2,{id:"upgrade-safety",children:"Upgrade safety"}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsxs)(s.li,{children:["Contracts follow the UUPS proxy pattern with storage separation (e.g. ",(0,n.jsx)(s.code,{children:"PositionStorage"}),") to avoid layout collisions."]}),"\n",(0,n.jsxs)(s.li,{children:["Behaviour tests call ",(0,n.jsx)(s.code,{children:"upgrades.erc1967.getImplementationAddress"})," to ensure proxies point to valid implementation addresses and reject re-initialisation."]}),"\n",(0,n.jsxs)(s.li,{children:["Upgrade proposals require timelock delay and are documented in ",(0,n.jsx)(s.code,{children:"docs/architecture.md"})," (root repo)."]}),"\n"]}),"\n",(0,n.jsx)(s.h2,{id:"incident-response",children:"Incident response"}),"\n",(0,n.jsxs)(s.ol,{children:["\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:"Detect"})," \u2014 Monitoring stack subscribes to ",(0,n.jsx)(s.code,{children:"ExecutionSkipped"}),", ",(0,n.jsx)(s.code,{children:"CircuitBreakerTriggered"}),", and off-chain price alerts."]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:"Diagnose"})," \u2014 Compare on-chain state via ",(0,n.jsx)(s.code,{children:"getPosition"})," and event logs to identify the failure mode."]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:"Mitigate"})," \u2014 Pause affected assets or globally if necessary; notify users and keepers."]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:"Recover"})," \u2014 When safe, resume automation or allow users to trigger ",(0,n.jsx)(s.code,{children:"emergencyWithdraw"}),"."]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:"Post-mortem"})," \u2014 Document incident in ",(0,n.jsx)(s.code,{children:"/docs/user-flow.md"})," (root) and update relevant runbooks."]}),"\n"]}),"\n",(0,n.jsx)(s.p,{children:"Adhering to these processes keeps BitcoinDCA resilient even during market stress or infrastructure outages."})]})}function h(e={}){const{wrapper:s}={...(0,t.R)(),...e.components};return s?(0,n.jsx)(s,{...e,children:(0,n.jsx)(a,{...e})}):a(e)}},6879:(e,s,i)=>{i.d(s,{R:()=>c,x:()=>o});var r=i(3303);const n={},t=r.createContext(n);function c(e){const s=r.useContext(t);return r.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function o(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:c(e.components),r.createElement(t.Provider,{value:s},e.children)}}}]);