"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[465],{6784:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>o,contentTitle:()=>c,default:()=>h,frontMatter:()=>r,metadata:()=>i,toc:()=>l});const i=JSON.parse('{"id":"reference/events","title":"Events & Telemetry","description":"Catalogue of DCA Crypto contract events, their payloads, and usage in analytics pipelines.","source":"@site/docs/reference/events.md","sourceDirName":"reference","slug":"/reference/events","permalink":"/docs/reference/events","draft":false,"unlisted":false,"editUrl":"https://github.com/bobjiang/dcacrypto/tree/main/docs/docs/reference/events.md","tags":[],"version":"current","frontMatter":{"title":"Events & Telemetry","sidebar_label":"Events","description":"Catalogue of DCA Crypto contract events, their payloads, and usage in analytics pipelines."},"sidebar":"primarySidebar","previous":{"title":"API Reference","permalink":"/docs/reference/api-reference"},"next":{"title":"Configuration","permalink":"/docs/reference/configuration"}}');var d=t(7711),s=t(6879);const r={title:"Events & Telemetry",sidebar_label:"Events",description:"Catalogue of DCA Crypto contract events, their payloads, and usage in analytics pipelines."},c="Events & Telemetry",o={},l=[{value:"Position lifecycle",id:"position-lifecycle",level:2},{value:"Funds movement",id:"funds-movement",level:2},{value:"Execution telemetry",id:"execution-telemetry",level:2},{value:"Configuration &amp; governance",id:"configuration--governance",level:2},{value:"Treasury",id:"treasury",level:2},{value:"Event ordering best practices",id:"event-ordering-best-practices",level:2},{value:"Sample listener (TypeScript)",id:"sample-listener-typescript",level:2}];function a(e){const n={code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(n.header,{children:(0,d.jsx)(n.h1,{id:"events--telemetry",children:"Events & Telemetry"})}),"\n",(0,d.jsx)(n.p,{children:"All events use indexed parameters for efficient filtering. Subscribe via your preferred RPC/WebSocket provider or leverage The Graph."}),"\n",(0,d.jsx)(n.h2,{id:"position-lifecycle",children:"Position lifecycle"}),"\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"Event"}),(0,d.jsx)(n.th,{children:"Description"})]})}),(0,d.jsxs)(n.tbody,{children:[(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"event PositionCreated(uint256 indexed positionId, address indexed owner, CreatePositionParams params);"})}),(0,d.jsxs)(n.td,{children:["Fired on ",(0,d.jsx)(n.code,{children:"createPosition"}),". Includes full parameter payload."]})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"event PositionModified(uint256 indexed positionId, ModifyParams params);"})}),(0,d.jsxs)(n.td,{children:["Fired on ",(0,d.jsx)(n.code,{children:"modify"}),"."]})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"event PositionPaused(uint256 indexed positionId);"})}),(0,d.jsx)(n.td,{children:"Pause flag set."})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"event PositionResumed(uint256 indexed positionId);"})}),(0,d.jsx)(n.td,{children:"Pause cleared."})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"event PositionCanceled(uint256 indexed positionId);"})}),(0,d.jsx)(n.td,{children:"Position closed, NFT burned."})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"event PositionEmergencyWithdrawn(uint256 indexed positionId, address indexed owner);"})}),(0,d.jsx)(n.td,{children:"Emergency exit finalised."})]})]})]}),"\n",(0,d.jsx)(n.h2,{id:"funds-movement",children:"Funds movement"}),"\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"Event"}),(0,d.jsx)(n.th,{children:"Description"})]})}),(0,d.jsxs)(n.tbody,{children:[(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"event Deposited(uint256 indexed positionId, address indexed token, uint256 amount);"})}),(0,d.jsxs)(n.td,{children:["Funds added via ",(0,d.jsx)(n.code,{children:"deposit"}),"."]})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"event Withdrawn(uint256 indexed positionId, address indexed token, uint256 amount, address to);"})}),(0,d.jsx)(n.td,{children:"Funds withdrawn."})]})]})]}),"\n",(0,d.jsx)(n.h2,{id:"execution-telemetry",children:"Execution telemetry"}),"\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"Event"}),(0,d.jsx)(n.th,{children:"Description"})]})}),(0,d.jsxs)(n.tbody,{children:[(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"event ExecutionCompleted(uint256 indexed positionId, address indexed keeper);"})}),(0,d.jsx)(n.td,{children:"Successful execution."})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"event ExecutionSkipped(uint256 indexed positionId, string reason);"})}),(0,d.jsxs)(n.td,{children:["Guard failure. Reason strings map to constants (",(0,d.jsx)(n.code,{children:"PRICE_DEVIATION"}),", ",(0,d.jsx)(n.code,{children:"GAS_CAP"}),", ",(0,d.jsx)(n.code,{children:"DEPEG"}),", ",(0,d.jsx)(n.code,{children:"PAUSED"}),", etc.)."]})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"event ExecutionDetails(uint256 indexed positionId, address indexed keeper, uint256 gasUsed, bytes routePath, int256 priceImpactBps, uint256 twapWindow, uint256 oracleTimestamp);"})}),(0,d.jsx)(n.td,{children:"Rich telemetry for analytics."})]})]})]}),"\n",(0,d.jsx)(n.h2,{id:"configuration--governance",children:"Configuration & governance"}),"\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"Event"}),(0,d.jsx)(n.th,{children:"Description"})]})}),(0,d.jsxs)(n.tbody,{children:[(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"event ProtocolConfigUpdated(ProtocolConfig newConfig);"})}),(0,d.jsx)(n.td,{children:"Fee changes."})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"event CircuitBreakerTriggered(string reason, uint256 timestamp);"})}),(0,d.jsx)(n.td,{children:"System-level guard engaged."})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"event CircuitBreakerConfigUpdated(CircuitBreakerConfig newConfig);"})}),(0,d.jsx)(n.td,{children:"Limit adjustments."})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"event RouterAdapterUpdated(uint16 venue, address adapter);"})}),(0,d.jsx)(n.td,{children:"Router permissions updated."})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"event OracleFeedUpdated(address token, address feed);"})}),(0,d.jsx)(n.td,{children:"Chainlink feed change."})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"event KeeperRegistryUpdated(address chainlink, address gelato);"})}),(0,d.jsx)(n.td,{children:"Automation registry updates."})]})]})]}),"\n",(0,d.jsx)(n.h2,{id:"treasury",children:"Treasury"}),"\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"Event"}),(0,d.jsx)(n.th,{children:"Description"})]})}),(0,d.jsxs)(n.tbody,{children:[(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"event FeeConfigurationUpdated(FeeConfig newConfig);"})}),(0,d.jsx)(n.td,{children:"Execution fee parameters updated."})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"event FeeWithdrawn(address indexed token, uint256 amount, address indexed to);"})}),(0,d.jsx)(n.td,{children:"Treasury disbursement."})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"event TimelockScheduled(bytes32 indexed id, address target, uint256 value, bytes data, uint256 executeAt);"})}),(0,d.jsx)(n.td,{children:"Timelock action scheduled."})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"event TimelockExecuted(bytes32 indexed id);"})}),(0,d.jsx)(n.td,{children:"Timelock completed."})]})]})]}),"\n",(0,d.jsx)(n.h2,{id:"event-ordering-best-practices",children:"Event ordering best practices"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"Store block timestamps alongside raw event data to reconstruct execution cadence."}),"\n",(0,d.jsxs)(n.li,{children:["Use ",(0,d.jsx)(n.code,{children:"ExecutionSkipped"})," reasons to trigger alerts. ",(0,d.jsx)(n.code,{children:"contracts/test/security/DOSProtection.test.ts"})," illustrates the mapping."]}),"\n",(0,d.jsx)(n.li,{children:"For analytics dashboards, enrich events with oracle data at the time of execution to show TWAP vs execution price."}),"\n",(0,d.jsxs)(n.li,{children:["Index ",(0,d.jsx)(n.code,{children:"PositionCreated"})," \u2192 ",(0,d.jsx)(n.code,{children:"PositionNFT"})," transfer logs to maintain an authoritative position ownership history."]}),"\n"]}),"\n",(0,d.jsx)(n.h2,{id:"sample-listener-typescript",children:"Sample listener (TypeScript)"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-typescript",metastring:'title="listeners/executionFeed.ts"',children:'import { ethers } from "ethers";\nimport DcaManager from "@bitcoindca/contracts/abis/DcaManager.json";\nimport Executor from "@bitcoindca/contracts/abis/Executor.json";\n\nconst provider = new ethers.WebSocketProvider(process.env.RPC_WS!);\nconst executor = new ethers.Contract(process.env.EXECUTOR!, Executor.abi, provider);\n\nexecutor.on("ExecutionCompleted", (positionId, keeper, event) => {\n  console.log("Executed", {\n    positionId: positionId.toString(),\n    keeper,\n    txHash: event.transactionHash,\n  });\n});\n\nexecutor.on("ExecutionSkipped", (positionId, reason) => {\n  console.warn("Skipped", positionId.toString(), reason);\n});\n'})}),"\n",(0,d.jsxs)(n.p,{children:["The ABI paths align with the generated artifacts from ",(0,d.jsx)(n.code,{children:"pnpm -F contracts build"}),"."]})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,d.jsx)(n,{...e,children:(0,d.jsx)(a,{...e})}):a(e)}},6879:(e,n,t)=>{t.d(n,{R:()=>r,x:()=>c});var i=t(3303);const d={},s=i.createContext(d);function r(e){const n=i.useContext(s);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(d):e.components||d:r(e.components),i.createElement(s.Provider,{value:n},e.children)}}}]);