"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[222],{6598:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>d,default:()=>h,frontMatter:()=>r,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"troubleshooting/troubleshooting","title":"Troubleshooting Runbook","description":"Operational checklist for diagnosing and resolving common BitcoinDCA incidents.","source":"@site/docs/troubleshooting/troubleshooting.md","sourceDirName":"troubleshooting","slug":"/troubleshooting/","permalink":"/docs/troubleshooting/","draft":false,"unlisted":false,"editUrl":"https://github.com/bobjiang/bitcoindca/tree/main/docs/docs/troubleshooting/troubleshooting.md","tags":[],"version":"current","frontMatter":{"title":"Troubleshooting Runbook","sidebar_label":"Troubleshooting","description":"Operational checklist for diagnosing and resolving common BitcoinDCA incidents."},"sidebar":"primarySidebar","previous":{"title":"FAQ","permalink":"/docs/troubleshooting/faq"}}');var t=i(7711),o=i(6879);const r={title:"Troubleshooting Runbook",sidebar_label:"Troubleshooting",description:"Operational checklist for diagnosing and resolving common BitcoinDCA incidents."},d="Troubleshooting Runbook",c={},l=[{value:"1. Execution skipped",id:"1-execution-skipped",level:2},{value:"2. Keeper not executing",id:"2-keeper-not-executing",level:2},{value:"3. Oracle issues",id:"3-oracle-issues",level:2},{value:"4. Routing failures",id:"4-routing-failures",level:2},{value:"5. Emergency withdrawal requests",id:"5-emergency-withdrawal-requests",level:2},{value:"6. Frontend anomalies",id:"6-frontend-anomalies",level:2},{value:"7. Documentation updates",id:"7-documentation-updates",level:2},{value:"8. Communication checklist",id:"8-communication-checklist",level:2}];function a(e){const n={code:"code",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,o.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"troubleshooting-runbook",children:"Troubleshooting Runbook"})}),"\n",(0,t.jsx)(n.p,{children:"Use this runbook when automation or execution issues arise. It complements the FAQ with deeper operational steps."}),"\n",(0,t.jsx)(n.h2,{id:"1-execution-skipped",children:"1. Execution skipped"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Identify reason"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Check ",(0,t.jsx)(n.code,{children:"ExecutionSkipped(positionId, reason)"})," event."]}),"\n",(0,t.jsxs)(n.li,{children:["Map reason to guard using ",(0,t.jsx)(n.code,{children:"frontend/lib/protocol.ts"})," ",(0,t.jsx)(n.code,{children:"EXECUTION_REASONS"}),"."]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.strong,{children:"Action matrix"})}),"\n"]}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Reason"}),(0,t.jsx)(n.th,{children:"Likely cause"}),(0,t.jsx)(n.th,{children:"Mitigation"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"PRICE_DEVIATION"})}),(0,t.jsx)(n.td,{children:"Oracle vs TWAP mismatch"}),(0,t.jsxs)(n.td,{children:["Verify Chainlink feeds (",(0,t.jsx)(n.code,{children:"PriceOracle.getQuoteUsd"}),"), adjust ",(0,t.jsx)(n.code,{children:"maxPriceDeviationBps"}),", or wait for volatility to subside."]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"DEPEG"})}),(0,t.jsx)(n.td,{children:"Stablecoin price off $1"}),(0,t.jsx)(n.td,{children:"Pause positions, notify users, allow emergency withdraw if persistent."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"GAS_CAP"})}),(0,t.jsx)(n.td,{children:"Base/priority fee > configured caps"}),(0,t.jsx)(n.td,{children:"Increase caps or wait for cheaper block conditions."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"PAUSED"})}),(0,t.jsx)(n.td,{children:"Position or system paused"}),(0,t.jsx)(n.td,{children:"Resume once safe."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"INSUFFICIENT_FUNDS"})}),(0,t.jsx)(n.td,{children:"Deposit too low"}),(0,t.jsxs)(n.td,{children:["Top up via ",(0,t.jsx)(n.code,{children:"deposit"}),"."]})]})]})]}),"\n",(0,t.jsxs)(n.p,{children:["Refer to ",(0,t.jsx)(n.code,{children:"contracts/test/security/MEVProtection.test.ts"})," and ",(0,t.jsx)(n.code,{children:"DOSProtection.test.ts"})," to understand guard triggers."]}),"\n",(0,t.jsx)(n.h2,{id:"2-keeper-not-executing",children:"2. Keeper not executing"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"Check Chainlink/Gelato dashboards for task status."}),"\n",(0,t.jsxs)(n.li,{children:["Ensure ",(0,t.jsx)(n.code,{children:"KEEPER_ROLE"})," still covers registry addresses (",(0,t.jsx)(n.code,{children:"executor.hasRole"}),")."]}),"\n",(0,t.jsx)(n.li,{children:"Confirm grace period not exceeded. If exceeded, encourage public execution or run a manual keeper script:"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"pnpm -F contracts ts-node scripts/manualExecute.ts --position 42\n"})}),"\n",(0,t.jsxs)(n.ol,{start:"4",children:["\n",(0,t.jsx)(n.li,{children:"Review recent contract upgrades or config changes that may have invalidated automation."}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"3-oracle-issues",children:"3. Oracle issues"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["Inspect ",(0,t.jsx)(n.code,{children:"PriceOracle.getQuoteUsd"})," timestamps for staleness."]}),"\n",(0,t.jsxs)(n.li,{children:["Compare TWAP data from ",(0,t.jsx)(n.code,{children:"getTwap"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:["If Chainlink feed is stale, trigger ",(0,t.jsx)(n.code,{children:"CircuitBreakerTriggered"})," via ",(0,t.jsx)(n.code,{children:"PAUSER_ROLE"})," and investigate provider status."]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"4-routing-failures",children:"4. Routing failures"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"For CoW, ensure solver endpoints are reachable and the adapter has approval to spend funds."}),"\n",(0,t.jsx)(n.li,{children:"For Uniswap v3, check pool liquidity and fee tier availability."}),"\n",(0,t.jsx)(n.li,{children:"For 1inch, validate aggregator payload generation."}),"\n",(0,t.jsxs)(n.li,{children:["Use ",(0,t.jsx)(n.code,{children:"simulate(positionId)"})," to reproduce failing routes with trace logs."]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"5-emergency-withdrawal-requests",children:"5. Emergency withdrawal requests"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["User initiates ",(0,t.jsx)(n.code,{children:"emergencyWithdraw"}),". Record timestamp."]}),"\n",(0,t.jsxs)(n.li,{children:["After the delay, assist with ",(0,t.jsx)(n.code,{children:"completeEmergencyWithdraw"}),"."]}),"\n",(0,t.jsx)(n.li,{children:"Audit balances before and after to confirm invariants."}),"\n",(0,t.jsxs)(n.li,{children:["Document the incident in ",(0,t.jsx)(n.code,{children:"docs/user-flow.md"})," if systemic."]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"6-frontend-anomalies",children:"6. Frontend anomalies"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Run ",(0,t.jsx)(n.code,{children:"pnpm -F frontend lint"})," and ",(0,t.jsx)(n.code,{children:"pnpm -F frontend test"}),"."]}),"\n",(0,t.jsx)(n.li,{children:"Clear local storage/session caches (RainbowKit)."}),"\n",(0,t.jsxs)(n.li,{children:["Validate environment variables (",(0,t.jsx)(n.code,{children:"NEXT_PUBLIC_DCA_MANAGER"}),", etc.)."]}),"\n",(0,t.jsxs)(n.li,{children:["Compare API responses with on-chain data via ",(0,t.jsx)(n.code,{children:"getPosition"})," to identify caching issues."]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"7-documentation-updates",children:"7. Documentation updates"}),"\n",(0,t.jsx)(n.p,{children:"When new incident types emerge:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["Add reason codes to ",(0,t.jsx)(n.code,{children:"frontend/lib/protocol.ts"}),"."]}),"\n",(0,t.jsx)(n.li,{children:"Update this runbook and relevant guides."}),"\n",(0,t.jsxs)(n.li,{children:["Regenerate docs (",(0,t.jsx)(n.code,{children:"pnpm -F docs build"}),") and redeploy."]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"8-communication-checklist",children:"8. Communication checklist"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Notify users via Discord/EPNS."}),"\n",(0,t.jsx)(n.li,{children:"Pin skip reasons and mitigations to dashboard banners."}),"\n",(0,t.jsx)(n.li,{children:"For prolonged incidents, activate maintenance mode and block new positions until resolved."}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(a,{...e})}):a(e)}},6879:(e,n,i)=>{i.d(n,{R:()=>r,x:()=>d});var s=i(3303);const t={},o=s.createContext(t);function r(e){const n=s.useContext(o);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:r(e.components),s.createElement(o.Provider,{value:n},e.children)}}}]);